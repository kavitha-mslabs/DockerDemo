<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	xmlns:leaf="http://java.sun.com/jsf/composite/jsf2leaf">

<h:head>
	<!--<f:metadata charset="utf-8" />
   	<f:metadata name="viewport" content="width=device-width, initial-scale=1" />  -->
	<!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
	<title>Tamil Nadu Generation and Distribution Corporation Limited (TANGEDCO)</title>
	<!-- All Stylesheets -->
	<link rel="stylesheet"  href="#{request.contextPath}/resources/css/all-stylesheets.css" />
	<link rel="stylesheet" href="#{request.contextPath}/resources/css/bootstrap.min.css" />
	<link rel="stylesheet" href="#{request.contextPath}/resources/css/site.css"  />
	<link rel="stylesheet" href="#{request.contextPath}/resources/css/layout.css"  />
	<link rel="stylesheet" 	href="#{request.contextPath}/resources/css/effect.css" />
	<link rel="stylesheet" 	href="#{request.contextPath}/resources/css/flashy.min.css" />
	<link rel='stylesheet' href='#{request.contextPath}/resources/css/count.css' />
	<link rel='stylesheet' href='#{request.contextPath}/resources/css/ticker.css'  />
	<link rel="stylesheet"  href="#{request.contextPath}/resources/css/leaflet.css"/>
	<link rel="shortcut icon" href="#{request.contextPath}/resources/images/favicon.ico" type="image/x-icon" />
	<link rel="icon" href="#{request.contextPath}/images/favicon.ico" type="image/x-icon" />
	
	<style type="text/css">
	    .ui-filter-column .ui-column-customfilter .custom-filter {
	        width: 100%;
	        box-sizing: border-box;
	    }
	    .title-box {
	    background: #1a237e;
    margin: 0;
    padding: 10px !important;
    color: #fff !important;
    }
    .btn-lg {
    padding: 10px 30px !important;
}
	</style>
	
	 <script type="text/javascript">
 	
	 function validateCircleExport(){
	    	
         var fromDateValue = document.getElementById("reportForm:fromDate_input");
         var toDateValue = document.getElementById("reportForm:toDate_input");
         
         $('[id="span' + toDateValue.id + '"]').remove();
         
         if(fromDateValue.value != "" &amp;&amp; toDateValue.value != ""){
        	 var fromDate  = new Date(fromDateValue.value).getTime();
        	 var toDate  = new Date(toDateValue.value).getTime();
        	 
        	 if(fromDate > toDate){
         		 $('[id="' + toDateValue.id + '"]').after("&lt;span style='color:red;' id='span"+toDateValue.id+"'&gt; To date can't be lesser than from date! &lt;/span&gt;");
         			return false;
         	 } else {
         		 var differenceInTime = new Date(toDateValue.value).getTime() - new Date(fromDateValue.value).getTime();
            	 var differenceInDays = differenceInTime / (1000 * 3600 * 24);
            	 
//             	 if(differenceInDays > 31) {
//             		 $('[id="' + toDateValue.id + '"]').after("&lt;span style='color:red;' id='span"+toDateValue.id+"'&gt; Date difference between from date and to date can't be more than a month! &lt;/span&gt;");
//           			return false;
//             	 }
         	 }
        	  
         }
         
         var circleFilter = document.getElementById("reportForm:circle_filter");
         var o = circleFilter.getElementsByTagName('input');
         var cnt = 0;
         for ( var i in o ) {
             if ( o[i].type=='checkbox' ) {
                 if ( o[i].checked ) {
                     cnt++;
                 }
             }
         }
         if(cnt == 0)
         {
        	 showSelectErrorMessage(circleFilter.id, circleFilter.value, "Circle");
         }
         
         showSelectErrorMessage(fromDateValue.id, fromDateValue.value, "From Date");
         showSelectErrorMessage(toDateValue.id, toDateValue.value, "To Date");
         
         if(fromDateValue.value == "" || toDateValue.value == "" || cnt == 0){
        	 return false;
         } else {
        	 return true;
         }
    }
	 
	 
	 function validateCircleDivisionExport(){
	    	
         var fromDateValue = document.getElementById("reportForm:fromDateTwo_input");
         var toDateValue = document.getElementById("reportForm:toDateTwo_input");
         
         $('[id="span' + toDateValue.id + '"]').remove();
         
         if(fromDateValue.value != "" &amp;&amp; toDateValue.value != ""){
        	 var fromDate  = new Date(fromDateValue.value).getTime();
        	 var toDate  = new Date(toDateValue.value).getTime();
        	 
        	 if(fromDate > toDate){
         		 $('[id="' + toDateValue.id + '"]').after("&lt;span style='color:red;' id='span"+toDateValue.id+"'&gt; To date can't be lesser than from date! &lt;/span&gt;");
         			return false;
         	 } else {
         		 var differenceInTime = new Date(toDateValue.value).getTime() - new Date(fromDateValue.value).getTime();
            	 var differenceInDays = differenceInTime / (1000 * 3600 * 24);

//             	 if(differenceInDays > 31) {
//             		 $('[id="' + toDateValue.id + '"]').after("&lt;span style='color:red;' id='span"+toDateValue.id+"'&gt; Date difference between from date and to date can't be more than a month! &lt;/span&gt;");
//           			return false;
//             	 }
         	 }
        	  
         }
         
         var circleFilter = document.getElementById("reportForm:circle_division_filter");
         var o = circleFilter.getElementsByTagName('input');
         var cnt = 0;
         for ( var i in o ) {
             if ( o[i].type=='checkbox' ) {
                 if ( o[i].checked ) {
                     cnt++;
                 }
             }
         }
         if(cnt == 0)
         {
        	 showSelectErrorMessage(circleFilter.id, circleFilter.value, "Circle");
         }
         
         showSelectErrorMessage(fromDateValue.id, fromDateValue.value, "From Date");
         showSelectErrorMessage(toDateValue.id, toDateValue.value, "To Date");
         
         if(fromDateValue.value == "" || toDateValue.value == "" || cnt == 0){
        	 return false;
         } else {
        	 return true;
         }
    }
    
	 function showSelectErrorMessage(fieldId, fieldValue, fieldLabel){
			if(fieldValue == "" || fieldValue == null){
			 $('[id="span' + fieldId + '"]').remove();
	       	 $('[id="' + fieldId + '"]').after("&lt;span style='color:red;' id='span"+fieldId+"'&gt;Please Select "+fieldLabel+"&lt;/span&gt;");
	       } else if(fieldValue != "" || fieldValue != null){
				 $('[id="span' + fieldId + '"]').remove();
	       }
		}
	 	
	 	function clearErrorMessage(tagid){
		    $('[id="span' + tagid + '"]').remove();
		}
	 	
	 	//Function to remove the error message on the click off the input field.
		$(document).ready(function () {
			$("input[type=text]").click(function () {
				 var currentElement = $(this);
			     var tagid = currentElement.attr('id');
			     $('[id="span' + tagid + '"]').remove();
			});
		});
	 
 	</script>
 	#{callCenterReport.setFilter()}
</h:head>
<h:body class="home-01">
	<ui:insert name="header">
		<ui:include src="/callcenterheader.xhtml" />
	</ui:insert>
	<p:ajaxStatus onstart="PF('statusDialog').show()"	oncomplete="PF('statusDialog').hide()" />
	<p:dialog widgetVar="statusDialog" modal="true" draggable="false" closable="false" resizable="false" showHeader="false">
		<p:graphicImage name="images/ajax-loader.gif" />
	</p:dialog>
	<h:form id="reportForm">
				      
		<div class="container-fluid">
				<br/>
				<div class="col-md-6 offset-md-3">
				<p:growl id="messages" styleClass="ng-deep"   showDetail="true"  />
				<h5 class="text-center pb-3 title-box">Circle Level Report</h5>
				<div class="card shadow mb-1 p-5 pt-2 ml-0">
				<div class="card-body p-1">
				
					<p:outputPanel id="pnlReportCircle">
					
					<div class="form-group">
						<div class="row">
							<div class="col-md-4">
								<h:outputLabel for="circle_filter" value="Circle" />
							</div>
							<div class="col-md-8">
								<p:selectCheckboxMenu id="circle_filter" onchange="clearErrorMessage('reportForm:circle_filter')"
									value="#{callCenterReport.circleFilter}" label="Circle"
									multiple="true" filter="true" filterMatchMode="startsWith"
									 styleClass="col-md-12">
									<f:selectItems var="des" value="#{callCenterReport.listCircle}"
										itemLabel="#{des.name}" itemValue="#{des.id}"/>
								</p:selectCheckboxMenu>
							</div>
						</div>
					</div>
					
					
					<div class="form-group">
						<div class="row">
							<div class="col-md-4">
								<h:outputLabel for="fromDate" value="From Date :" />
							</div>
							<div class="col-md-8">
								<p:datePicker id="fromDate" pattern="dd-MM-yyyy" maxdate="#{callCenterReport.currentDate}" mindate="#{callCenterReport.minDate}"
									value="#{callCenterReport.fromDate}" readonlyInput="true" size="30"/>
							</div>
						</div>
						<div class="row mt-3">
							<div class="col-md-4" >
								<h:outputLabel for="toDate" value="To Date :" />
							</div>
							<div class="col-md-8">
								<p:datePicker id="toDate" pattern="dd-MM-yyyy" maxdate="#{callCenterReport.currentDate}" mindate="#{callCenterReport.minDate}"
									value="#{callCenterReport.toDate}" readonlyInput="true" size="30"/>
							</div>
						</div>
					</div>
				
				
						<div class="row">
							<div class="col-md-12 text-center mt-3">
								<p:commandButton value="Export as Pdf" ajax="false" onclick="return validateCircleExport()" styleClass="fa fa-download btn-sm btn-danger"
								 update="messages pnlReportCircle circle_filter" action="#{callCenterReport.generateCircleReport('pdf')}"/>
								&#160;
								<p:commandButton value="Export as Excel" ajax="false" onclick="return validateCircleExport()" styleClass="fa fa-download btn-sm btn-danger"
								 update="messages pnlReportCircle circle_filter" action="#{callCenterReport.generateCircleReport('excel')}"/>
								
							</div>
						</div>
						
					</p:outputPanel>
					
				</div>
				</div></div></div>
				
				<br/>
				
				<div class="container-fluid">
				<br/>
				<div class="col-md-6 offset-md-3">
				<h5 class="text-center pb-3 title-box">Division Level Report</h5>
				<div class="card shadow mb-1 p-5 pt-2 ml-0">
				<div class="card-body p-1">
				
					
					<p:outputPanel id="pnlReportCircleDivision">
					
					
					<div class="form-group">
						<div class="row">
							<div class="col-md-4">
								<h:outputLabel for="circle_division_filter" value="Circle" />
							</div>
							<div class="col-md-8">
								<p:selectCheckboxMenu id="circle_division_filter" onchange="clearErrorMessage('reportForm:circle_division_filter')"
									value="#{callCenterReport.circleDivisionFilter}" label="Circle"
									multiple="true" filter="true" filterMatchMode="startsWith"
									 styleClass="col-md-12">
									<f:selectItems var="des" value="#{callCenterReport.listCircle}"
										itemLabel="#{des.name}" itemValue="#{des.id}"/>
								</p:selectCheckboxMenu>
							</div>
						</div>
					</div>
					
					<div class="form-group">
						<div class="row">
							<div class="col-md-4">
								<h:outputLabel for="fromDateTwo" value="From Date :" />
							</div>
							<div class="col-md-8">
								<p:datePicker id="fromDateTwo" pattern="dd-MM-yyyy" maxdate="#{callCenterReport.currentDate}" mindate="#{callCenterReport.minDate}"
									value="#{callCenterReport.fromDateTwo}" readonlyInput="true" size="30"/>
							</div>
						</div>
						<div class="row mt-3">
							<div class="col-md-4" >
								<h:outputLabel for="toDateTwo" value="To Date :" />
							</div>
							<div class="col-md-8">
								<p:datePicker id="toDateTwo" pattern="dd-MM-yyyy" maxdate="#{callCenterReport.currentDate}" mindate="#{callCenterReport.minDate}"
									value="#{callCenterReport.toDateTwo}" readonlyInput="true" size="30"/>
							</div>
						</div>
					</div>
				
				
						<div class="row">
							<div class="col-md-12 text-center mt-3">
								<p:commandButton value="Export as Pdf" ajax="false" onclick="return validateCircleDivisionExport()" 
								styleClass="fa fa-download btn-sm btn-danger" update="messages pnlReportCircleDivision" action="#{callCenterReport.generateCircleDivisionReport('pdf')}"/>
								&#160;
								<p:commandButton value="Export as Excel" ajax="false" onclick="return validateCircleDivisionExport()" 
								styleClass="fa fa-download btn-sm btn-danger" update="messages pnlReportCircleDivision" action="#{callCenterReport.generateCircleDivisionReport('excel')}"/>
								
							</div>
						</div>
						
					</p:outputPanel>
					
				</div>
				</div></div></div>
				
				<br/><br/><br/>
				
					<!--	T H I S   M O D A L   I S   F O R   V I E W I N G  P R O F I L E -->
		
		<p:dialog header="My Profile" widgetVar="dlgProfile" modal="true"
			showEffect="drop" hideEffect="drop" width="450" height="350">
			<div class="form-group mb-1">
				<div class="input-field">
					<h:outputLabel for="profile_Office" value="Office" />
					<p:inputText id="profile_Office" onkeydown="return (event.keyCode!=13);" readonly="true"
						value="#{admin.auth.officer.officeName}"
						styleClass="form-control">
					</p:inputText>
				</div>
			</div>
			<div class="form-group mb-1">
				<div class="input-field">
					<h:outputLabel for="profile_Username" value="User Name" />
					<p:inputText id="profile_Username" onkeydown="return (event.keyCode!=13);" readonly="true"
						value="#{admin.auth.officer.userName}" styleClass="form-control">
					</p:inputText>
				</div>
			</div>

			<f:facet name="footer" class="modal-footer">
				<p:commandButton value="Cancel" styleClass="btn btn-danger"
					oncomplete="PF('dlgProfile').hide();" />
			</f:facet>
		</p:dialog>
				
				
	</h:form>
</h:body>
</html>