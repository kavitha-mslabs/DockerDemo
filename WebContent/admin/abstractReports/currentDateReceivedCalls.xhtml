<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:p="http://primefaces.org/ui">

<h:head>
    <title>Tamil Nadu Generation and Distribution Corporation Limited (TANGEDCO)</title>

    <!-- CSS Files -->
    <link rel="stylesheet" href="#{request.contextPath}/resources/css/all-stylesheets.css" />
    <link rel="stylesheet" href="#{request.contextPath}/resources/css/layout.css" />
    <link rel="stylesheet" href="#{request.contextPath}/resources/css/effect.css" />

    <style>
body {
            font-family: Arial, sans-serif;
            background-color: #f4f6f9;
            margin: 0;
            padding: 0;
        }
        
        .scrollable-container {
            width: 100%;
            height: calc(100vh - 100px);
            overflow: auto;
            border: 1px solid #ddd;
            margin-bottom: 20px;
        }
        
        .inner-scrollable {
            width: 100%;
            min-width: fit-content;
        }
        
        .report-container {
            width: 100%;
            background: white;
            padding: 20px;
        }
        
        .report-title {
            text-align: center;
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
        }
        
        .hours-info {
            text-align: center;
            font-size: 16px;
            margin-bottom: 20px;
        }
        
        .export-buttons {
            margin-left: auto;
            display: flex;
            gap: 10px;
        }
        
        .data-table {
            width: 100%;
            border: 1px solid #000;
            border-collapse: collapse;
        }
        
        .data-table .ui-column-header {
            background-color: #f2f2f2;
            border: 1px solid #000;
            padding: 8px;
            font-weight: bold;
        }
        
        .hours-container {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .data-table .ui-datatable-data tr {
            border: 1px solid #000;
        }
        
        .data-table .ui-datatable-data td {
            border: 1px solid #000;
            padding: 8px;
        }
        
        .button-container {
            text-align: center;
            margin-top: 20px;
        }
        
        .report-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
        }
        
        .report-header span {
            font-size: 15px;
            font-weight: bold;
        }
        
        .hours-info {
            font-size: 16px;
        }
        
        .home-button {
            background: #6c757d !important;
            color: white !important;
            font-size: 14px !important;
            padding: 8px 20px !important;
            border-radius: 4px !important;
            font-weight: bold !important;
        }
        
        .no-complaints {
            text-align: center;
            font-size: 16px;
            color: #666;
            padding: 20px;
            border: 1px solid #ddd;
            background-color: #f9f9f9;
            margin-top: 20px;
        }
        #complaintReportForm{
        margin-top:-40px !important;
        }
</style>
</h:head>

<h:body>
    <ui:insert name="header">
        <ui:include src="/header.xhtml" />
    </ui:insert>

    <h:form id="complaintReportForm">
<f:metadata>
    <f:event type="preRenderView" listener="#{currentDateCalls.resetIfNeeded()}" />
</f:metadata>
     <div class="scrollable-container">
     <div class="inner-scrollable">
        <div class="report-container">
        
          <div class="report-header">
			<div class="report-title">CURRENT DATE - COMPLAINT RECEIVED ABSTRACT</div>
		 
                <div style="display: flex; justify-content: center; align-items: center; gap: 20px;padding :10px !important">
				    <div class="report-title">- #{currentDateCalls.dmFilter.hours} Hour(s)</div>
				    <p:commandButton value="HOME"
				                    class="btn btn-md btn-info"
				                    action="#{currentDateCalls.redirectToHome()}"
				                     />
               </div>
            
				<div class="export-buttons">
                <p:commandButton value="Export as Excel"
                    actionListener="#{currentDateCalls.exportToExcel(currentDateCalls.sectionCounts)}"
                    ajax="false"
                    styleClass="ui-button-success"
                    style="margin-right: 10px;">
                    <p:fileDownload value="#{currentDateCalls.excelFile}" />
                </p:commandButton>

                <p:commandButton value="Export as PDF"
                    actionListener="#{currentDateCalls.exportToPdf(currentDateCalls.sectionCounts)}"
                    ajax="false"
                    styleClass="ui-button-danger">
                    <p:fileDownload value="#{currentDateCalls.pdfFile}" />
                </p:commandButton>
            </div>
        </div>

<ui:fragment rendered="#{not empty currentDateCalls.sectionCounts}">
	      <p:dataTable value="#{currentDateCalls.sectionCounts}" var="item" 
	             styleClass="compact-table" liveResize="true" resizableColumns="true"
	             columnVisibility="true" showGridlines="true" rowIndexVar="rowIndex">
	
	    <p:columnGroup type="header">
	        <p:row>
	            <p:column headerText="S.No" style="background:#1a237e !important;color:#fff !important; width:25px!important;"/>
	            <p:column headerText="Section Name" style="background:#1a237e !important;color:#fff !important;"/>
	            <p:column headerText="Division Name" style="background:#1a237e !important;color:#fff !important"/>
	            <p:column headerText="Circle Name" style="background:#1a237e !important;color:#fff !important"/>
	            <p:column headerText="Received Complaints" style="background:#1a237e !important;color:#fff !important"/>
	        </p:row>
	    </p:columnGroup>
	
	    <p:column>
	        <h:outputText value="#{rowIndex + 1}" />
	    </p:column>
	
	    <p:column>
	        <h:outputText value="#{item.sectionName}" />
	    </p:column>
	
	    <p:column>
	        <h:outputText value="#{item.divisionName}" />
	    </p:column>
	
	    <p:column>
	        <h:outputText value="#{item.circleName}" />
	    </p:column>
	
	    <p:column>
	        <h:outputText value="#{item.receivedComplaints}" />
	    </p:column>
	</p:dataTable>
	
</ui:fragment>

<ui:fragment rendered="#{empty currentDateCalls.sectionCounts}">
             <div class="no-complaints">
                  There are no complaints received for the past #{currentDateCalls.dmFilter.hours} hour(s)
             </div>
</ui:fragment>	



        </div>
        </div>
        </div>
    </h:form>
</h:body>
</html>