<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui">

<h:head>
	<title>Tamil Nadu Generation and Distribution Corporation Limited (TANGEDCO) </title>

	<!-- CSS Files -->
	<link rel="stylesheet"
		href="#{request.contextPath}/resources/css/all-stylesheets.css" />
	<link rel="stylesheet"
		href="#{request.contextPath}/resources/css/bootstrap.min.css" />
	<link rel="stylesheet"
		href="#{request.contextPath}/resources/css/site.css" />
	<link rel="stylesheet"
		href="#{request.contextPath}/resources/css/layout.css" />
	<link rel="stylesheet"
		href="#{request.contextPath}/resources/css/effect.css" />
	<link rel="stylesheet"
		href="#{request.contextPath}/resources/css/flashy.min.css" />
	<link rel="stylesheet"
		href="#{request.contextPath}/resources/css/count.css" />
	<link rel="stylesheet"
		href="#{request.contextPath}/resources/css/ticker.css" />
	<link rel="stylesheet"
		href="#{request.contextPath}/resources/css/leaflet.css" />
	<link rel="shortcut icon"
		href="#{request.contextPath}/resources/images/favicon.ico"
		type="image/x-icon" />


	<style>
	.scrollable-container {
            width: 100%;
            height: calc(100vh - 100px);
            overflow: auto;
            border: 1px solid #ddd;
            margin-bottom: 20px;
           }
        
			.inner-scrollable {
				width: 100%;
				min-width: fit-content;
			}
	#complaintDetailForm{
margin-top:-40px !important;
}
</style>
</h:head>

<h:body class="home-01">

	<ui:insert name="header">
		<ui:include src="/header.xhtml" />
	</ui:insert>

	<!-- Loading Dialog -->
	<p:ajaxStatus onstart="PF('statusDialog').show()"
		oncomplete="PF('statusDialog').hide()" />
	<p:dialog widgetVar="statusDialog" modal="true" draggable="false"
		closable="false" resizable="false" showHeader="false">
		<p:graphicImage name="images/ajax-loader.gif" />
	</p:dialog>

	<h:form id="complaintDetailForm">
	<div class="scrollable-container">
      <div class="inner-scrollable">
		<p:panel id="reportPanel" styleClass="mb-3">
			<f:facet name="header">
				<div class="report-header">
					<span>COMPLAINT DETAIL </span>
					<div class="export-buttons">
						<p:commandButton value="Export as Excel"
							actionListener="#{monthWiseAbstractReport.exportToExcel(monthWiseAbstractReport.circleList)}"
							ajax="false" styleClass="ui-button-success"
							style="margin-right: 20px;">
							<p:fileDownload value="#{monthWiseAbstractReport.excelFile}" />
						</p:commandButton>

						<p:commandButton value="Export as PDF"
							actionListener="#{monthWiseAbstractReport.exportToPdf(monthWiseAbstractReport.circleList)}"
							ajax="false" styleClass="ui-button-danger">
							<p:fileDownload value="#{monthWiseAbstractReport.pdfFile}" />
						</p:commandButton>
					</div>
				</div>
			</f:facet>
			<div class="filter-container">

				<div class="date-group">
					<h:outputLabel for="fromDate" value="Month And Year:"
						styleClass="form-label" />
					<p:datePicker id="fromDate"
						value="#{monthWiseAbstractReport.dmFilter.fromDate}"
						pattern="MM/yyyy" view="month" minView="month"
						monthNavigator="true" yearNavigator="true" yearRange="2015:2100"
						placeholder="Select month/year"
						styleClass="form-label compact-datepicker" showIcon="true"
						panelStyle="width: 200px; height: auto;"
						panelStyleClass="compact-datepicker-panel">
					</p:datePicker>
				</div>

				<div class="filter-group">
					<h:outputLabel for="complaint_type" value="Complaint Type"
						styleClass="form-label" />
					<p:selectOneMenu id="complaint_type"
						value="#{monthWiseAbstractReport.dmFilter.complaintType}"
						label="Complaint Type" styleClass="form-control">
						<f:selectItem itemLabel="ALL" itemValue="AL" />
						<f:selectItem itemLabel="Power Failure" itemValue="PF" />
						<f:selectItem itemLabel="Voltage Related" itemValue="VF" />
						<f:selectItem itemLabel="Meter Related" itemValue="ME" />
						<f:selectItem itemLabel="Billing Related" itemValue="BL" />
						<f:selectItem itemLabel="Fire" itemValue="FI" />
						<f:selectItem itemLabel="Dangerous Pole" itemValue="TH" />
						<f:selectItem itemLabel="Theft of Power" itemValue="TE" />
						<f:selectItem itemLabel="Conductor Snapping" itemValue="CS" />
						<f:selectItem itemLabel="Others" itemValue="OT" />
					</p:selectOneMenu>
				</div>



				<div class="filter-group">

					<h:outputLabel for="device" value="Devices" styleClass="form-label" />

					<p:selectOneMenu id="device"
						value="#{monthWiseAbstractReport.dmFilter.device}"
						label="Devices" styleClass="form-control">

						<f:selectItem itemLabel="ALL" itemValue="L" />

						<f:selectItem itemLabel="MOBILE" itemValue="P" />

						<f:selectItem itemLabel="WEB" itemValue="W" />

						<f:selectItem itemLabel="SM" itemValue="S" />

						<f:selectItem itemLabel="FOC" itemValue="A" />

						<f:selectItem itemLabel="MINNAGAM" itemValue="M" />

						<f:selectItem itemLabel="MM" itemValue="G" />

					</p:selectOneMenu>

				</div>


					<h:commandButton value="Search"
						actionListener="#{monthWiseAbstractReport.searchCircleMonthlyAbstract}"
						update="reportPanel reportTable" process="@form"
						 />
				
			</div>

			<!-- Report Table -->
			<p:dataTable id="reportTable" var="report"
				value="#{monthWiseAbstractReport.circleList}"
				styleClass="compact-table" liveResize="true" resizableColumns="true"
				columnVisibility="true" showGridlines="true">

				<p:columnGroup type="header" class="sticky-header">
					<p:row>
						<p:column headerText="Region" rowspan="2" />

						<p:column headerText="Circle" rowspan="2" />

						<!-- TOTAL Group -->
						<p:column headerText="Total" />

						<!-- LIVE Group -->
						<p:column headerText="Live" />

						<!-- COMPLETED Group -->
						<p:column headerText="Completed" />

						<!-- TMP Group -->
						<p:column headerText="Tmp" />


					</p:row>


				</p:columnGroup>

				<!-- Region & Circle -->
				<p:column styleClass="fixed-column-region">
					<h:outputText value="#{report.regionName}"
						style="white-space: normal; word-wrap: break-word;" />
				</p:column>

				<p:column styleClass="fixed-column-circle">
					<p:commandLink value="#{report.circleName}"
						actionListener="#{monthWiseAbstractReport.fetchReportByCircle(report.cirCode,report.circleName)}"
						update="reportTable" process="@this"
						style="white-space: normal; word-wrap: break-word;">
					</p:commandLink>
				</p:column>

				<!-- BL Columns -->
				<p:column>
					<h:outputText value="#{report.tot1}" />
				</p:column>
				<p:column>
					<h:outputText value="#{report.live1}" />
				</p:column>
				<p:column>
					<h:outputText value="#{report.cpl1}" />
				</p:column>
				<p:column>
					<h:outputText value="#{report.tmp1}" />
				</p:column>



				<p:columnGroup type="footer">
					<p:row styleClass="total-footer">
						<p:column colspan="2" footerText="TOTAL"
							styleClass="category-header" />

						<p:column
							footerText="#{monthWiseAbstractReport.circleList.stream().map(r -> r.tot1).sum()}" />
						<p:column
							footerText="#{monthWiseAbstractReport.circleList.stream().map(r -> r.live1).sum()}" />
						<p:column
							footerText="#{monthWiseAbstractReport.circleList.stream().map(r -> r.cpl1).sum()}" />
						<p:column
							footerText="#{monthWiseAbstractReport.circleList.stream().map(r -> r.tmp1).sum()}" />

					</p:row>
				</p:columnGroup>

			</p:dataTable>

		</p:panel>
		</div>
		</div>
	</h:form>
</h:body>
</html>