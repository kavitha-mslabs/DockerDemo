<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:p="http://primefaces.org/ui">

<h:head>
    <title>Tamil Nadu Generation and Distribution Corporation Limited (TANGEDCO) - Abstract Report</title>

    <!-- CSS Files -->
    <link rel="stylesheet" href="#{request.contextPath}/resources/css/all-stylesheets.css" />
    <link rel="stylesheet" href="#{request.contextPath}/resources/css/bootstrap.min.css" />
    <link rel="stylesheet" href="#{request.contextPath}/resources/css/site.css" />
    <link rel="stylesheet" href="#{request.contextPath}/resources/css/layout.css" />
    <link rel="stylesheet" href="#{request.contextPath}/resources/css/effect.css" />
    <link rel="stylesheet" href="#{request.contextPath}/resources/css/flashy.min.css" />
    <link rel="stylesheet" href="#{request.contextPath}/resources/css/count.css" />
    <link rel="stylesheet" href="#{request.contextPath}/resources/css/ticker.css" />
    <link rel="stylesheet" href="#{request.contextPath}/resources/css/leaflet.css" />
    <link rel="shortcut icon" href="#{request.contextPath}/resources/images/favicon.ico" type="image/x-icon" />


   
    <!-- CSS Files (keep existing links) -->
    <style>
/* Improved Date Picker Styles */
.form-container {
    display: flex;
    gap: 1.5rem;
    align-items: flex-end;
    margin-bottom: 1.5rem;
}
.compact-datepicker .ui-inputfield {
    width: 200px !important;
    padding: 0.5rem 1rem !important;
    font-size: 0.9em !important;
    border: 1px solid #dee2e6 !important;
    border-radius: 4px !important;
}

.compact-datepicker .ui-datepicker-trigger {
    margin-left: 0.5rem !important;
    color: #6c757d !important;
}

/* Column Header Fixes */
.fixed-column-region {
	min-width: 120px !important;
	max-width: 150px !important;
	white-space: nowrap !important;
}

.fixed-column-circle {
	min-width: 150px !important;
	max-width: 180px !important;
	white-space: nowrap !important;
}

/* Improved Table Styles */
.compact-table .ui-datatable-header, .compact-table th {
	font-size: 0.85em;
	padding-top: 3px 5px !important;
	background: #f8f9fa !important;
}

.compact-table td {
	font-size: 0.90em;
	padding: 8px 8px !important;
	white-space: nowrap;
}

.sticky-header {
	position: sticky;
	top: 0;
	background: white !important;
	z-index: 100;
	box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

/* Compact Form Layout */
.form-grid {
	display: grid;
	grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
	gap: 1rem;
	align-items: end;
	margin-bottom: 1.9rem;
}
.custom-button {
    background-color: #007bff;
    color: white;
    border: 8px solid #007bff;
    padding: 1px 20px;
    font-size: 14px;
    border-radius: 4px;
    cursor: pointer;
}

.custom-button:hover {
    background-color: #0056b3;
    border-color: #0056b3;
}
</style>
</h:head>

<h:body class="home-01">

    <!-- Include Header -->
    <ui:insert name="header">
        <ui:include src="../header.xhtml" />
    </ui:insert>

    <!-- Loading Dialog -->
    <p:ajaxStatus onstart="PF('statusDialog').show()" oncomplete="PF('statusDialog').hide()" />
    <p:dialog widgetVar="statusDialog" modal="true" draggable="false" closable="false" resizable="false" showHeader="false">
        <p:graphicImage name="images/ajax-loader.gif" />
    </p:dialog>

        <h:form id="circleReportForm">
        <p:panel id="reportPanel" header="Circle Report" styleClass="mb-3">
            <div class="form-container">
            <div class="date-group">
                <label for="fromDate">From :</label>
					<p:datePicker id="fromDate"
						value="#{circleReportBean.dmFilter.fromDate}" pattern="dd-MM-yyyy"
						mindate="01-01-2020" maxdate="31-12-2030"
						placeholder="Select start date" styleClass="compact-datepicker"
						monthNavigator="true" yearNavigator="true" yearRange="2015:2100"
						numberOfMonths="1" showIcon="true" />
				</div>

            <div class="date-group">
                <label for="toDate">To :</label>
					<p:datePicker id="toDate"
						value="#{circleReportBean.dmFilter.toDate}" pattern="dd-MM-yyyy"
						placeholder="Select end date" styleClass="compact-datepicker"
						monthNavigator="true" yearNavigator="true" yearRange="2015:2100"
						numberOfMonths="1" showIcon="true" />
				</div>

           <h:commandButton value="Search" 
                 actionListener="#{circleReportBean.search}"
                 update="reportPanel reportTable" 
                 process="@form" />
            </div>

            <!-- Report Table -->
            <p:dataTable id="reportTable" 
                       var="report" 
                       value="#{circleReportBean.reports}"
                       styleClass="compact-table"
                       liveResize="true"
                       resizableColumns="true"
                       columnVisibility="true">
                       
                <p:columnGroup type="header" class="sticky-header">
                    <p:row>
                        <p:column headerText="Region" rowspan="2" styleClass="fixed-column-region"/>
                        <p:column headerText="Circle" rowspan="2" styleClass="fixed-column-circle"/>
                        
                        <!-- BL Group -->
                        <p:column headerText="Billing Releated" colspan="3" styleClass="category-header"/>
                        
                        <!-- Meter Group -->
                        <p:column headerText="Meter Releated" colspan="3" styleClass="category-header"/>
                        
                        <!-- PF Group -->
                        <p:column headerText="Power Failure" colspan="3" styleClass="category-header"/>
                        
                        <!-- Voltage Group -->
                        <p:column headerText="Voltage Fluctuation" colspan="3" styleClass="category-header"/>
                        
                        <!-- Fire Group -->
                        <p:column headerText="Fire" colspan="3" styleClass="category-header"/>
                        
                        <!-- Danger Group -->
                        <p:column headerText="Dangerous Pole" colspan="3" styleClass="category-header"/>
                        
                        <!-- Theft Group -->
                        <p:column headerText="Theft" colspan="3" styleClass="category-header"/>
                        
                        <!-- Conductor Snapping Group -->
                        <p:column headerText="Conductor Snapping" colspan="3" styleClass="category-header"/>
                        
                        <!-- Others Group -->
                        <p:column headerText="Others" colspan="3" styleClass="category-header"/>
                    </p:row>
                    
                    <p:row>
                        <!-- BL Subheaders -->
                        <p:column headerText="Tot"/>
                        <p:column headerText="Comp"/>
                        <p:column headerText="Pend"/>
                        
                        <!-- Meter Subheaders -->
                        <p:column headerText="Tot"/>
                        <p:column headerText="Comp"/>
                        <p:column headerText="Pend"/>
                        
                        <!-- PF Subheaders -->
                        <p:column headerText="Tot"/>
                        <p:column headerText="Comp"/>
                        <p:column headerText="Pend"/>
                        
                        <!-- Voltage Subheaders -->
                        <p:column headerText="Tot"/>
                        <p:column headerText="Comp"/>
                        <p:column headerText="Pend"/>
                        
                        <!-- Fire Subheaders -->
                        <p:column headerText="Tot"/>
                        <p:column headerText="Comp"/>
                        <p:column headerText="Pend"/>
                        
                        <!-- Danger Subheaders -->
                        <p:column headerText="Tot"/>
                        <p:column headerText="Comp"/>
                        <p:column headerText="Pend"/>
                        
                        <!-- Theft Subheaders -->
                        <p:column headerText="Tot"/>
                        <p:column headerText="Comp"/>
                        <p:column headerText="Pend"/>
                        
                        <!-- Conductor Snapping  Subheaders -->
                        <p:column headerText="Tot"/>
                        <p:column headerText="Comp"/>
                        <p:column headerText="Pend"/>
                        
                        <!-- Others  Subheaders -->
                        <p:column headerText="Tot"/>
                        <p:column headerText="Comp"/>
                        <p:column headerText="Pend"/>
                        
                    </p:row>
                </p:columnGroup>

                <!-- Region & Circle -->
                <p:column styleClass="fixed-column-region">
                    <h:outputText value="#{report.regname}" style="white-space: normal; word-wrap: break-word; max-width: 250px;"/>
                </p:column>
                
                <!-- Circle Column -->
				<p:column styleClass="fixed-column-circle">
					<p:commandLink value="#{report.cirname}"
						actionListener="#{circleReportBean.fetchReportByCircle(report.circode)}"
						update="reportTable" process="@this">
						<h:outputText value="#{report.cirname}"
							style="white-space: normal; word-wrap: break-word; max-width: 250px;" />
					</p:commandLink>
				</p:column>

				<!-- BL Columns -->
                <p:column>
                    <h:outputText value="#{report.blTot}"/>
                </p:column>
                <p:column>
                    <h:outputText value="#{report.blCom}"/>
                </p:column>
                <p:column>
                    <h:outputText value="#{report.blPen}"/>
                </p:column>

                <!-- Meter Columns -->
                <p:column>
                    <h:outputText value="#{report.meTot}"/>
                </p:column>
                <p:column>
                    <h:outputText value="#{report.meCom}"/>
                </p:column>
                <p:column>
                    <h:outputText value="#{report.mePen}"/>
                </p:column>
                
                <!-- PF Columns -->
                <p:column>
                    <h:outputText value="#{report.pfTot}"/>
                </p:column>
                <p:column>
                    <h:outputText value="#{report.pfCom}"/>
                </p:column>
                <p:column>
                    <h:outputText value="#{report.pfPen}"/>
                </p:column>
                
               <!-- Voltage Columns -->
                <p:column>
                    <h:outputText value="#{report.vfTot}"/>
                </p:column>
                <p:column>
                    <h:outputText value="#{report.vfCom}"/>
                </p:column>
                <p:column>
                    <h:outputText value="#{report.vfPen}"/>
                </p:column>
                
                <!-- Fire Columns -->
                <p:column>
                    <h:outputText value="#{report.fiTot}"/>
                </p:column>
                <p:column>
                    <h:outputText value="#{report.fiCom}"/>
                </p:column>
                <p:column>
                    <h:outputText value="#{report.fiPen}"/>
                </p:column>
                
                <!-- Dangerous Pole Columns -->
                <p:column>
                    <h:outputText value="#{report.thTot}"/>
                </p:column>
                <p:column>
                    <h:outputText value="#{report.thCom}"/>
                </p:column>
                <p:column>
                    <h:outputText value="#{report.thPen}"/>
                </p:column>
                
                <!-- Theft Pole Columns -->
                <p:column>
                    <h:outputText value="#{report.thTot}"/>
                </p:column>
                <p:column>
                    <h:outputText value="#{report.thCom}"/>
                </p:column>
                <p:column>
                    <h:outputText value="#{report.thPen}"/>
                </p:column>
                
                <!-- Conductor snapping Columns -->
                <p:column>
                    <h:outputText value="#{report.csTot}"/>
                </p:column>
                <p:column>
                    <h:outputText value="#{report.csCom}"/>
                </p:column>
                <p:column>
                    <h:outputText value="#{report.csPen}"/>
                </p:column>
                
                 <!-- Others Columns -->
                <p:column>
                    <h:outputText value="#{report.otTot}"/>
                </p:column>
                <p:column>
                    <h:outputText value="#{report.otCom}"/>
                </p:column>
                <p:column>
                    <h:outputText value="#{report.otPen}"/>
                </p:column>

                
            </p:dataTable>
        </p:panel>
    </h:form>
</h:body>
</html>